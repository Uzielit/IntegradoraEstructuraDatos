<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Simulador de AtenciÃ³n ED</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .custom-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 15px; }
        .custom-table th { text-align: left; padding: 12px; background-color: #f8fafc; color: #64748b; border-bottom: 2px solid #e2e8f0; }
        .custom-table td { padding: 12px; border-bottom: 1px solid #e2e8f0; color: #334155; vertical-align: middle; }
        .avatar { width: 30px; height: 30px; background: #e0f2fe; color: #0369a1; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.75rem; margin-right: 8px; }
        .action-btn { background: none; border: none; cursor: pointer; font-weight: 600; font-size: 0.85rem; padding: 0; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">ğŸ¢ Simulador ED</div>
    <a href="/" class="menu-item active">ğŸ“Š Panel General</a>
    <a href="/clientes" class="menu-item">ğŸ‘¥ Clientes</a>
    <a href="/ajustes" class="menu-item">âš™ï¸ Ajustes</a>
    <div style="margin-top: auto; font-size: 0.8rem; color: #64748b;">Sistema V 3.0<br>En lÃ­nea</div>
</div>

<div class="main-content">
    <div class="top-bar">
        <div>
            <h2 style="margin:0;">Control de Servicio</h2>
            <span style="color:var(--text-secondary);">Administra fila, cajeros y clientes.</span>
        </div>
        <form th:action="@{/buscar}" method="post" class="search-container">
            <span>ğŸ”</span>
            <input type="text" name="query" class="search-input" placeholder="Buscar..." required>
            <button type="submit" style="display:none;"></button>
        </form>
    </div>

    <div th:if="${!busqueda.isEmpty()}" style="background:#fff3cd; color:#856404; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #ffeeba;">
        <strong th:text="${busqueda}"></strong>
    </div>

    <div class="grid-container">

        <div class="card">
            <div class="card-header">
                <div class="card-title"><h3>ğŸ•’ Sala de Espera</h3><span>Clientes formados (FIFO)</span></div>
                <form th:action="@{/ticket/resolver}" method="post"><button class="btn btn-success">âœ… Atender</button></form>
            </div>

            <div th:if="${tickets.isEmpty()}" style="text-align:center; padding:10px; color:#94a3b8;">Fila vacÃ­a.</div>

            <ul class="data-list">
                <li class="data-item" th:each="t : ${tickets}">
                    <div><strong>#<span th:text="${t.id}"></span></strong> - <span th:text="${t.nombreCliente}"></span></div>
                    <span class="status-badge bg-blue" th:text="${t.tipoProblema}">Motivo</span>
                </li>
            </ul>

            <div class="action-area">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <small><strong>Nuevo Turno & Registro</strong></small>
                    <form th:action="@{/ticket/auto}" method="post"><button class="btn btn-primary" style="padding:4px 8px; font-size:0.7rem;">ğŸ¤– Random</button></form>
                </div>
                <form th:action="@{/ticket/nuevo}" method="post" style="display:flex; flex-direction:column; gap:8px;">
                    <div style="display:flex; gap:5px;">
                        <input type="text" name="cliente" placeholder="Nombre" class="form-input" style="flex:1;" required>
                        <input type="text" name="asunto" placeholder="Motivo" class="form-input" style="flex:1;" required>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <input type="text" name="email" placeholder="Email" class="form-input" style="flex:1;">
                        <input type="text" name="telefono" placeholder="TelÃ©fono" class="form-input" style="flex:1;">
                    </div>
                    <button class="btn btn-primary" style="width:100%;">Formar y Registrar</button>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><div class="card-title"><h3>ğŸ‘¨â€ğŸ’¼ Cajeros</h3><span>Activos (Lista)</span></div></div>
            <ul class="data-list">
                <li class="data-item" th:each="op, stat : ${agentes}">
                    <span><span style="color:#22c55e;">â—</span> <span th:text="${op.nombre}"></span></span>
                    <form th:action="@{/agente/baja}" method="post"><input type="hidden" name="indice" th:value="${stat.index}"><button class="btn btn-danger" style="padding:2px 8px;">Baja</button></form>
                </li>
            </ul>
            <div class="action-area">
                <form th:action="@{/agente/nuevo}" method="post" class="input-group"><input type="text" name="nombre" placeholder="Nombre" class="form-input" required><button class="btn btn-primary">Add</button></form>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><div class="card-title"><h3>âš¡ Reciente</h3><span>BitÃ¡cora (LIFO)</span></div><form th:action="@{/auditoria/borrar}" method="post"><button class="btn btn-danger">Borrar</button></form></div>
            <ul class="data-list"><li class="data-item" th:each="log : ${auditoria}"><span th:text="${log}" style="font-family:monospace; font-size:0.8rem;"></span></li></ul>
        </div>

        <div class="card">
            <div class="card-header"><div class="card-title"><h3>ğŸ—‚ï¸ Historial</h3><span>Ãrbol</span></div></div>
            <ul class="data-list">
                <li class="data-item" th:each="file : ${archivo}">
                    <span th:text="${file}" style="font-family:monospace;"></span>
                    <form th:action="@{/archivo/borrar}" method="post"><input type="hidden" name="dato" th:value="${file}"><button style="border:none; background:none; cursor:pointer; color:#ef4444;">ğŸ—‘ï¸</button></form>
                </li>
            </ul>
        </div>
    </div>

    <div class="card" style="margin-top: 30px; border-top: 4px solid #3b82f6;">
        <div class="card-header">
            <div class="card-title"><h3>ğŸ‘¥ Directorio de Clientes</h3><span>Base de datos en tiempo real.</span></div>
            <a href="/clientes" class="btn btn-primary" style="text-decoration:none; font-size:0.85rem;">Pantalla Completa</a>
        </div>
        <div style="overflow-x: auto;">
            <table class="custom-table">
                <thead><tr><th>Cliente</th><th>Empresa</th><th>Contacto</th><th>Estatus</th><th>Acciones</th></tr></thead>
                <tbody>
                <tr th:if="${listaClientes.isEmpty()}"><td colspan="5" style="text-align:center; padding:20px; color:#94a3b8;">Sin registros.</td></tr>
                <tr th:each="c : ${listaClientes}">
                    <td>
                        <div style="display:flex; align-items:center;">
                            <div class="avatar" th:text="${#strings.substring(c.nombre,0,1)}">A</div>
                            <div><strong th:text="${c.nombre}" style="display:block;"></strong><span th:text="'ID: #' + ${c.id}" style="font-size:0.75rem; color:#94a3b8;"></span></div>
                        </div>
                    </td>
                    <td th:text="${c.empresa}">Empresa</td>
                    <td><div style="display:flex; flex-direction:column; font-size:0.85rem;"><span th:text="${c.email}">email</span><span th:text="${c.telefono}" style="color:#94a3b8;">tel</span></div></td>
                    <td><span class="status-badge bg-green">Activo</span></td>
                    <td style="display:flex; gap:15px; align-items:center;">
                        <a th:href="@{/cliente/editar/{id}(id=${c.id})}" class="action-btn" style="color:#3b82f6; text-decoration:none;">âœï¸ Editar</a>
                        <form th:action="@{/cliente/eliminar}" method="post" style="margin:0;"><input type="hidden" name="id" th:value="${c.id}"><button type="submit" class="action-btn" style="color:#ef4444;" onclick="return confirm('Â¿Baja?');">ğŸ—‘ï¸ Baja</button></form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>